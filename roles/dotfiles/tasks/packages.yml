- name: update pacman cache
  become: yes
  community.general.pacman:
    update_cache: yes
  when: ansible_os_family == "Archlinux"

- name: update apt cache
  become: yes
  ansible.builtin.apt:
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: install useful packages
  become: yes
  ansible.builtin.package:
    name:
      - git
      - tig
      - man-db
      - vim
      - htop
      - iotop
      - powertop
      - tree
      - dos2unix
      - ncdu
      - unzip
      - lnav
      - multitail
      - xclip
      - tilda
      - nodejs
      - npm
      - gimp
      - vlc  # vlc from flatpak has some problems
    state: latest

- name: backup current pacman mirrorlist
  become: yes
  ansible.builtin.copy:
    src: /etc/pacman.d/mirrorlist
    dest: /etc/pacman.d/mirrorlist.backup
    force: no
  when: ansible_os_family == "Archlinux"

- name: install reflector (pacman mirrorlist auto-updater)
  become: yes
  community.general.pacman:
    name: reflector
    state: latest
  when: ansible_os_family == "Archlinux"

- name: enable and restart reflector service
  become: yes
  ansible.builtin.systemd:
    name: reflector
    enabled: yes
    state: restarted
  when: ansible_os_family == "Archlinux"
