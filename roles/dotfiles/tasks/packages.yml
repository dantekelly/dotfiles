- name: update pacman cache
  become: yes
  community.general.pacman:
    update_cache: yes
  when: ansible_os_family == "Archlinux"

- name: update apt cache
  become: yes
  ansible.builtin.apt:
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: install cli packages
  become: yes
  ansible.builtin.package:
    name:
      - git
      - tig
      - man-db
      - vim
      - htop
      - iotop
      - powertop
      - tree
      - ncdu
      - unzip
      - lnav
      - multitail
      - mlocate
      - wget
      - xclip
      - nodejs
      - npm
      - ttf-jetbrains-mono
      - neofetch
    state: latest

- name: install native apps
  become: yes
  ansible.builtin.package:
    name:
      # - tilda  (use ddterm gnome extension instead)
      - gimp
      - inkscape
      - vlc  # vlc from flatpak has some problems
      # - chromium (install google-chrome from AUR)
      - firefox
      - uget
      - meld
    state: latest

- name: install flatpak apps
  community.general.flatpak:
    name:
      - com.mattermost.Desktop
      #- com.toggl.TogglDesktop
      - com.transmissionbt.Transmission
      - fr.handbrake.ghb
      - org.keepassxc.KeePassXC
      - org.telegram.desktop
      - io.dbeaver.DBeaverCommunity
    state: present

- name: backup current pacman mirrorlist
  become: yes
  ansible.builtin.copy:
    src: /etc/pacman.d/mirrorlist
    dest: /etc/pacman.d/mirrorlist.backup
    force: no
  when: ansible_os_family == "Archlinux"

- name: install reflector (pacman mirrorlist auto-updater)
  become: yes
  community.general.pacman:
    name: reflector
    state: latest
  when: ansible_os_family == "Archlinux"

- name: enable and restart reflector service
  become: yes
  ansible.builtin.systemd:
    name: reflector
    enabled: yes
    state: restarted
  when: ansible_os_family == "Archlinux"
